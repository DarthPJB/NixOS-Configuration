{"path": "services/prometheus.nix", "purpose": "Configures Prometheus monitoring server with Grafana visualization, scraping metrics from various exporters across the NixOS network infrastructure.", "key_options": ["services.prometheus", "services.grafana", "networking.firewall.allowedTCPPorts"], "imports": [], "exports": ["Prometheus scrape configurations for node, zfs, nvidia-gpu, klipper, and dnsmasq exporters", "Grafana settings with dashboard and datasource provisioning", "Firewall rules for Prometheus and Grafana ports"], "dependencies": ["References to self.nixosConfigurations for dynamic port and target resolution"], "nixos_patterns": ["services.prometheus.scrapeConfigs for defining monitoring jobs", "services.grafana.provision for automated dashboard setup", "static_configs with targets for exporter endpoints"], "integration_points": ["Scrapes metrics from all major machines in 10.88.127.0/24 network (LINDA, cortex-alpha, data-storage, etc.)", "Grafana datasources connected to Prometheus for visualization", "Dashboard provisioning from ./graphana_dashboards directory", "Web external URL set for prometheus.${fqdn}"], "notes": "This module sets up comprehensive monitoring for the home lab. Prometheus scrapes node exporters (system metrics), ZFS exporters (storage), NVIDIA GPU exporters (graphics), Klipper exporter (3D printer), and dnsmasq exporter (DNS/DHCP) from various hosts. Scrape interval is 5 seconds for real-time monitoring. Grafana is configured on data-storage (10.88.127.3:3101) with dashboards from graphana_dashboards folder, using Prometheus as datasource. Firewall opens ports 8080 (Prometheus) and 3101 (Grafana). Labels include hostname and WireGuard IPs for identification. The configuration dynamically references ports from other machine configs, ensuring consistency. TODO for automating scraper addition with convergence style. This provides centralized observability for the entire network. Reasoning: The extensive list of targets and jobs indicates this is the monitoring hub for the infrastructure, enabling proactive management and troubleshooting of services and hardware across the VPN-connected machines."}