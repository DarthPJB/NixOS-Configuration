{"path": "machines/cortex-alpha/default.nix", "purpose": "NixOS configuration for cortex-alpha, the central router and gateway machine managing network services, SSL certificates, DNS/DHCP, VPN, and reverse proxies for the home network infrastructure.", "key_options": ["security.acme.defaults.email", "security.acme.certs.\"johnbargman.net\"", "services.prometheus.exporters.dnsmasq", "services.nginx.virtualHosts", "networking.wireguard.interfaces.wireg0", "networking.interfaces", "networking.firewall", "networking.nat", "services.dnsmasq.settings"], "imports": ["../../services/acme_server.nix", "../../server_services/ldap.nix", "../../configuration.nix", "./hardware-configuration.nix", "../../modifier_imports/zfs.nix"], "exports": ["boot configuration with sysctl for forwarding", "ACME certificate management", "nginx virtual hosts for reverse proxying", "wireguard VPN server configuration", "dnsmasq DNS and DHCP server", "NAT and port forwarding rules", "firewall interface rules"], "dependencies": [], "nixos_patterns": ["services.nginx.virtualHosts for hosting multiple domains", "networking.wireguard for VPN setup", "networking.nat.forwardPorts for port redirection", "services.dnsmasq.settings for DHCP and DNS configuration", "security.acme for automatic SSL certificates"], "integration_points": ["ACME server for SSL certificates on johnbargman.net and subdomains", "nginx reverse proxies to internal services (print-controller on 10.88.127.30, prometheus/grafana on 10.88.128.3, ap on 10.88.128.2)", "wireguard hub connecting all machines with IPs in 10.88.127.0/24", "dnsmasq providing DHCP to internal network 10.88.128.0/24 and DNS resolution", "NAT forwarding external ports to internal machines for gaming/streaming services", "prometheus dnsmasq exporter for monitoring"], "notes": "Cortex-alpha serves as the network gateway with public IP 82.5.173.252, internal IP 10.88.128.1. It handles IPv4 forwarding, WireGuard VPN server (listen port 2108, peers from wg_peers.nix), DNS and DHCP via dnsmasq with static leases for various machines (data-storage, print-controller, terminals, LINDA). Nginx provides SSL-terminated reverse proxies for subdomains like prometheus.johnbargman.net, grafana.johnbargman.net, etc., using ACME certificates from Let's Encrypt. Extensive port forwarding from external interface enp2s0 to internal IPs (e.g., Steam ports to LINDA at 10.88.128.88). Firewall allows specific TCP/UDP ports on interfaces for VPN, DNS, DHCP, and services. Boot config enables ZFS, sysctl for IP forwarding (IPv4 only, IPv6 TODO). Includes prometheus exporter for dnsmasq metrics. Services like LDAP and OpenSSH enabled. This machine is critical for network management, security, and service exposure in the home lab setup. Reasoning: The configuration emphasizes routing, security, and service aggregation, positioning cortex-alpha as the entry point and control center for the network. Comments indicate ongoing development for IPv6, port proxy modules, and iperf monitoring between systems."}